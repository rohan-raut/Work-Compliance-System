{% extends 'base.html' %}

{% block title %}Assign Task{% endblock title %}

{% block additional_links %}
<link rel="stylesheet" href="/static/assign_task.css">
{% endblock additional_links %}

{% block body %}


<div class="container mt-3 mb-3">
    <div class="row justify-content-center">
        <div class="col-12 col-sm-11 col-md-11 col-lg-9 border border-dark form_box">
            <h1 class="mb-4">Assign Task</h1>
            <form method="POST" action="/update-task-details/{{task_details.task_id}}/" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="mb-4">
                  <label for="title" class="form-label">Title</label>
                  <input type="text" class="form-control" name="title" value="{{task_details.title}}">
                </div>
                <div class="mb-4">
                    <label for="description" class="form-label">Description</label>
                    <textarea class="form-control" rows="3" name="description">{{task_details.description}}</textarea>
                </div>

                <div class="row">
                    <div class="col-12 col-sm-12 col-md-4 col-lg-4 mb-4">
                        <label for="assign_to" class="form-label">Assign To</label>
                        <select class="form-select" aria-label="Default select example" name="assign_to">
                            <option value="{{task_details.assignee_email}}" selected>{{task_details.assignee_name}}</option>
                            {% for x in user_info %}
                                <option value="{{x.email}}">{{x.name}}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="col-12 col-sm-12 col-md-4 col-lg-4 mb-4">
                        <label for="deadline" class="form-label">Deadline</label>
                        <input type="date" id="deadline" class="form-control" name="deadline">
                    </div>

                    <div class="col-12 col-sm-12 col-md-4 col-lg-4 mb-4">
                        <label for="upload_file" class="form-label">Upload File</label>
                        <input type="file" class="form-control" id="form_field" name="upload_file" onchange="update_file_list()" multiple>
                    </div>
                </div>

                <div class="mt-3" id="uploaded_file_list">
                    
                </div>
                
                
                <div class="d-flex justify-content-end">
                    <button type="submit" class="btn btn-primary">Update</button>
                </div>
              </form>
        </div>
    </div>
</div>

<script>
    let deadline = "{{task_details.deadline}}";
    deadline = deadline.split(' ');
    document.getElementById('deadline').value = deadline[0];

    let fileList = [];
    let file_cnt = 0;

    function fillfileList() {
        {% for x in files %}
            {% if x.uploaded_by_email == request.user.email %}
                fileList.push(new File([""], "{{x.file}}"));
            {% endif %}
        {% endfor %}
    }

    fillfileList();
    
</script>



<script src="/static/update-task-details.js"></script>

{% endblock body %}


